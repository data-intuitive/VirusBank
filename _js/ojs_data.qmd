```{ojs}
//| echo: false

FA = FileAttachment

nwk = await FA("/" + virusFamily + "/tree.newick").text()

// Toolbox
import { encodeTool } from '/_js/functions.js'

xls = await FileAttachment("./family.xlsx").xlsx()
annotations = xls.sheet(0, { headers: true, range: ":L" })
toolbox1 = await FileAttachment("/toolbox/toolbox.json").json()
toolbox = encodeTool(toolbox1)


// denormalized_list = 
//   toolbox
//     .flatMap(tool => {
//       return annotations.flatMap(virus => {
//         
//       })
//     })
// 
// 
//     .flatMap(tool => {
//       return annotations.flatMap(family => {
//         return family.info.map( virus => {
//           const this_toolbox = (virus.toolbox != undefined) ? virus.toolbox: []
//           if (this_toolbox.filter(t => t == tool.id).length > 0) {
//             return ({
//               family: family.family,
//               virus: virus.name,
//               virus_id: virus.id,
//               tool: tool.name,
//               tool_id: tool.id
//             })
//           }
//         })
//       })
//     })
//   .filter(el => el != undefined)

import { availableToolObjsF } from '/_js/functions.js'

function toolsForVirus(_family, _virus) {
  console.log(_family)
  console.log(_virus)
  console.log("tools:")
  const availableTools = availableToolObjsF(annotations, toolbox)
  return availableTools(_virus)
}

function renderTools(tools) {

  console.log(tools)

  if (tools.length > 0) {
    return html`
      ${tools.map(tool => 
        html`
          <h2 id="${tool.id}-section">${tool.name}</h2>
          <div class="container grid">
            <div class="g-col-2 toolbox" style="text-align:center;">
              <div class="tool-container">
                <div class="tool-wrapper">
                  <div class="tool-tooltip-text">${tool.name}</div>
                  <div id="${tool.id}" class="tool">
                    ${tool.icon.map( i =>
                    html`<img class="tool-icon" height="${(tool.icon.length > 1) ? 150/tool.icon.length : 100}%" src="${i}"/>`
                    )}
                  </div>
                </div>
              </div>
            </div>
            <div class="g-col-1"></div>
            <div class="g-col-7">
              <p>${tool.description}</p>
            </div>
            <div class="g-col-1" style="text-align:center;">
            </div>
          </div>
          <div class="col-xs-12" style="height:30px;"></div>
        `
      )}
    `
  } else {
    return html`
      <p>No tools have been developed for this virus yet.</p>
    `
  }
}
```
