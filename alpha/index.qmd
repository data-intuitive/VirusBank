---
title: Alphaviruses
title-block-banner: virus-banner.jpg
format:
  html:
    page-layout: full
    anchor-sections: true
    section-divs: true
params: na
---

```{ojs}
//| output: none
//| echo: false

import { d3 } from "./ojs_d3.qmd"

import { nwk } from "./ojs_data.qmd"
import { annotationsMap } from "./ojs_data.qmd"
import { toolbox } from "./ojs_data.qmd"
import { virus_toolbox } from "./ojs_data.qmd"
````
  
```{ojs}
//| output: none
//| echo: false

// Initialize a container to contain the containers for the tree and annotation window
html`

<div class="container">
  <div class="grid" style="--bs-gap: 0;">
    <div id="info-container" class="g-col-md-8 g-col-sm-12 text-center mb-2" style="visibility:hidden;">
      <div class="grid">
        <div id="name" class="g-col-md-12 bold">
          name
        </div>
        <div id="toolbox" class="g-col-md-12">
          no tools yet for this virus
        </div>
      </div>
    </div>
    <div id="tree-container" class="tree-container g-col-md-8 g-col-sm-12 text-center rounded"></div>
    <div id="annotation-container" class="g-col-md-4 g-col-sm-12 no-gutter">
      <div class="container grid small" align="center" style="--bs-gap: 1.0rem;font-weight:500;">
        <div class="g-col-md-12 g-col-sm-12 card card-body tool-header opacity-100" id="virus">
          Viral Toolbox
        </div>
        ${toolbox.map(tool => 
          html`
            <a href="/toolbox/index.html#${tool.id}-section" id="${tool.id}" class="g-col-6 border card bg-tool card-body tool">
              ${tool.name}
            </a>
          `
        )}
      </div>
    </div>
    <div id="legend-container" class="g-col-md-9 g-col-sm-12 text-center mb-2">
      <div class="grid p-2">
        <div class="g-col-md-12 small">
          <span class="phylotree-node-text" style="font-size:15px !important;">HOVER</span> for more information /
          <span class="phylotree-node-text-hl" style="font-size:15px !important;">BOLD NODES</span> can be selected /
          <span class="phylotree-node-text-inactive" style="font-size:15px !important;">INACTIVE NODES</span> are for reference
        </div>
      </div>
    </div>
  </div>
</div>
`
```
 
```{ojs}
//| output: none
//| echo: false
html`<link rel=stylesheet href='${resolve("phylotree@1.1.0/dist/phylotree.css")}'>`

height = 550
width = 550

phylotree = await require("phylotree@1.1/dist/phylotree.js");

```

<!-- {{< include _ojs_data.qmd >}} -->


```{ojs}
//| output: none
//| echo: false

availableVirusInfo = (virus_id) => annotationsMap[virus_id] != undefined

<!-- clearPopup = () => { -->
<!--   const ct = d3.select('#annotation-container') -->
<!--   ct.selectAll("*").remove() -->
<!-- } -->

availableTools = (virus_id) =>
    (annotationsMap[virus_id] != undefined)
    ? ( annotationsMap[virus_id].toolbox != undefined )
        ? annotationsMap[virus_id].toolbox
        : []
    : []

// If not tools are available yet, but the virus is important:
showAnyway = (virus_id) =>
    (annotationsMap[virus_id] != undefined)
    ? annotationsMap[virus_id].show
    : false

// Reset the tools in the Toolbox
clearToolbox = () => {

  // TODO: make dynamic
  d3.select("#cpe").attr("class",      "g-col-6 border round bg-tool card card-body tool")
  d3.select("#model").attr("class",    "g-col-6 border round bg-tool card card-body tool")
  d3.select("#yield").attr("class",    "g-col-6 border round bg-tool card card-body tool")
  d3.select("#reverse").attr("class",  "g-col-6 border round bg-tool card card-body tool")
  d3.select("#pcr").attr("class",      "g-col-6 border round bg-tool card card-body tool")
  d3.select("#plaque").attr("class",   "g-col-6 border round bg-tool card card-body tool")
  d3.select("#delay").attr("class",    "g-col-6 border round bg-tool card card-body tool")
  d3.select("#reporter").attr("class", "g-col-6 border round bg-tool card card-body tool")

}

// Update the tools in the toolbox based on the current virus
updateToolbox = (d) => {
  
  const toolbox = availableTools(d.data.name)

  // TODO: make dynamic
  toolbox.map(el => {
    if (el.tool == "cpe") d3.select("#cpe").attr("class",           "g-col-6 border card card-body bg-tool tool-selected")
    if (el.tool == "model") d3.select("#model").attr("class",       "g-col-6 border card card-body bg-tool tool-selected")
    if (el.tool == "yield") d3.select("#yield").attr("class",       "g-col-6 border card card-body bg-tool tool-selected")
    if (el.tool == "reverse") d3.select("#reverse").attr("class",   "g-col-6 border card card-body bg-tool tool-selected")
    if (el.tool == "pcr") d3.select("#pcr").attr("class",           "g-col-6 border card card-body bg-tool tool-selected")
    if (el.tool == "plaque") d3.select("#plaque").attr("class",     "g-col-6 border card card-body bg-tool tool-selected")
    if (el.tool == "delay") d3.select("#delay").attr("class",       "g-col-6 border card card-body bg-tool tool-selected")
    if (el.tool == "reporter") d3.select("#reporter").attr("class", "g-col-6 border card card-body bg-tool tool-selected")
  })
}

tabsetAnchor = 'tabset-7-1-tab'
virusToTab = ({
    CHIKV: "tabset-7-1-tab",
    RRV: "tabset-7-2-tab",
    MAYV: "tabset-7-3-tab",
    VEEV: "tabset-7-4-tab",
    SINV: "tabset-7-5-tab",
    SFV: "tabset-7-6-tab"
})

// Hide virus information tabset
// Wrap in closure to keep ojs happy
hide_tabset = {
  const virusInfo = document.getElementById(tabsetAnchor).parentNode.parentNode.parentNode
  virusInfo.style.display = "none"
}

tree = new phylotree.phylotree(nwk)   // class Phylotree
                                      // https://github.com/veg/phylotree.js/blob/master/src/main.js#L90

renderedTree = tree                   // class TreeRender
  .render({
    'left-right-spacing': 'fit-to-size',
    'top-bottom-spacing': 'fit-to-size',
    'is-radial':          true,
    'selectable':         false,
    'collapsible':        false,
    'transitions' :       true,
    'show-menu':          false,
    'show-scale':         false,
    'align-tips':         true,
    'width':              width,
    'height':             height,
    'zoom':               false,
    'minimal-per-node-spacing':  4,
    'minimum-per-level-spacing': 4,
    'container':          "#tree-container"
  })
  .style_nodes( (element, data) => {

    const inToolbox = (availableTools(data.data.name).length > 0) || showAnyway(data.data.name)
    const availableInfo = availableVirusInfo(data.data.name) 

    // Styling based on available information
    const updtElement1 =
      availableInfo
        ? element.select("text").attr("class", "phylotree-node-text")
        : element.select("text").attr("class", "phylotree-node-text-inactive")
    const updtElement = inToolbox ? element.select("text").attr("class", "phylotree-node-text-hl") : element

    // Hover functionality - Virus name
    if (availableInfo)
      element
        .on("mouseover", virus_hover_in(data, availableTools(data.data.name).length > 0))
        .on("mouseout", virus_hover_out)

    // Click functionality - Toolbox
    inToolbox
      ? element.on('click', function() {
          clearToolbox();
          // Select the first tab in order to get to the root of the tabset
          const virusInfo = document.getElementById(tabsetAnchor).parentNode.parentNode.parentNode
          virusInfo.style.display = "block"
          // Now get the proper tab
          const thisVirusInfo = document.getElementById(virusToTab[data.data.name])
          thisVirusInfo.click();
          updateToolbox(data);
        })
      : element.on('click', function() {
          clearToolbox();
        })

  })
  .layout(true)

// Show small virus information box on hover
virus_hover_in = (data, is_available) => () => {
  // First, populate the content
  d3.select("#name").text(annotationsMap[data.data.name].name)
  if (is_available)
    d3.select("#toolbox").text("Viral tools are available, please select the virus for more information")
  else
     d3.select("#toolbox").text("No viral tools have been developed yet")
  // ... then show the content
  d3.select("#info-container").attr("style", "visibility:visible;")
}
virus_hover_out = () => {
  d3.select("#info-container").attr("style", "visibility:hidden;")
}

// Add SVG to the DOM
tmp = d3.select("#tree-container").node().appendChild(renderedTree.svg.node())

```

&nbsp;

:::: {.panel-tabset}

## Chikungunya virus

{{< include _CHIKV.qmd >}}

:::{ style="text-align:center;font-weight:500" }
[open virus page](/alpha/CHIKV.qmd) / [reload family page](/alpha/)
:::

## River Ross virus

{{< include _RRV.qmd >}}

:::{ style="text-align:center;font-weight:500" }
[open virus page](/alpha/RRV.qmd) / [reload family page](/alpha/)
:::

## Mayaro virus

{{< include _MAYV.qmd >}}

:::{ style="text-align:center;font-weight:500" }
[open virus page](/alpha/MAYV.qmd) / [reload family page](/alpha/)
:::

## Venezuelan Equine Encephalitis virus

{{< include _VEEV.qmd >}}

:::{ style="text-align:center;font-weight:500" }
[open virus page](/alpha/VEEV.qmd) / [reload family page](/alpha/)
:::

## Sindbis virus

{{< include _SINV.qmd >}}

:::{ style="text-align:center;font-weight:500" }
[open virus page](/alpha/SINV.qmd) / [reload family page](/alpha/)
:::

## Semliki Forest virus

{{< include _SFV.qmd >}}

:::{ style="text-align:center;font-weight:500" }
[open page](/alpha/SFV.qmd) / [reload family page](/alpha/)
:::

::::
